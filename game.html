<DOCTYPE html>
<head>


</head>

<body>
	<canvas id="gameBoard" width="400px" height="600px" style="border:1px solid black"></canvas>


	<script>
		var blackBug = {
			color: "black",
			speed1: 150,
			speed2: 200,
			score: 5,
			probability: 0.3
		};

		var redBug = {
			color: "red",
			speed1: 75,
			speed2: 100,
			score: 3,
			probability: 0.3
		};

		var orangeBug = {
			color: "orange",
			speed1: 60,
			speed2: 80,
			score: 1,
			probability: 0.4
		};

		var canvas = document.getElementById("gameBoard");
		var ctx = canvas.getContext("2d");

		var position = function (x,y) {
			this.x = x;
			this.y = y;
		};

		var foodArray = [];
		var bugArray = [];

		function drawFood(x, y){
			var food = new Image();
			food.src = "food.jpg";

			food.onload = function(){
				ctx.drawImage(food, x - 10, y - 10, 20, 20);
				foodArray.push(new position(x, y));
			}
		}


		function makeNewBug(){
			var type = Math.random();

			if (type < 0.3){
				type = blackBug;
			} else if (type < 0.6){
				type = redBug
			} else{
				type = orangeBug;
			}

			var x = Math.random();
			x = 10 + x * 380;
			var y = 30;

			draw(x, y, Math.PI/2, type);
		}

		function draw(x, y, angle, type){
			var xhead = x + 5 * Math.cos(angle);
			var yhead = y + 5 * Math.sin(angle);
			var xtail = x - 15 * Math.cos(angle);
			var ytail = y - 15 * Math.sin(angle);

			ctx.beginPath();
			ctx.arc(xhead, yhead, 5, 0, 2 * Math.PI);
			ctx.fillStyle = "red";
			ctx.fill();
			ctx.strokeStyle = "black";
			ctx.stroke();
			ctx.closePath();

			console.log(xhead + " " + yhead + " " + xtail + " " + ytail);

			ctx.save(); // save state
        	ctx.beginPath();
	        ctx.translate(xtail, ytail);
	        ctx.rotate(angle);
	        ctx.scale(15, 5);
	        ctx.arc(0, 0, 1, 0, 2 * Math.PI, false);

	        ctx.fillStyle = "red";
	        ctx.restore(); // restore to original state
	        ctx.fill();
	        ctx.strokeStyle = "black";
			ctx.stroke();
	        ctx.closePath();
		}


		function findAngle(x1,y1,x2,y2){
			return theta = Math.atan2(y2-y1, x2-x1);
		}

		function drawBug(type, x, y){
			var distance = Math.pow(400, 2) + Math.pow(600, 2);
			var index;

			if (foodArray.length == 0){
				alert("gameover");
			} else{

				//find which food to run for. 
				for (var i = 0; i < foodArray.length; i++){
					var newdis = Math.pow(foodArray[i].x - x, 2) + Math.pow(foodArray[i].y - y, 2);
					if (newdis < distance){
						distance = newdis;
						index = i;
					}
				}

				angle = findAngle(x, y, foodArray[index].x, foodArray[index].y);
				draw(x, y, angle, orangeBug);
			}
		}

		
		drawFood(390, 100);
		drawFood(100, 300);
		drawFood(100, 100);

		console.log("got here");
		drawBug(orangeBug, 200, 200);


		makeNewBug();
	</script>
</body>